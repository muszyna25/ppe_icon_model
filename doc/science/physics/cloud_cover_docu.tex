\chapter Cloud Cover and Water Distribution

\begin{center}
{\scshape Martin K\"{o}hler } \\
{Deutscher Wetterdienst, Offenbach} \\
{email: martin.koehler@dwd.de} \\[5mm]
\end{center}
\section{Introduction}

The treatment of the sub-grid-scale cloud distribution 
in the ICON model as used for NWP are described here.  Note that the ICON-NWP
model currently predicts and advects the grid-scale specific water quantities: 
water vapor, cloud liquid water, cloud ice, rain and snow.  These grid-scale
values are used by microphysics (named q1, q2, q3, q4 and q5).  
Note also that the turbulence scheme 
calculates a separate temporary cloud
cover for use in the calculation of the buoyancy flux.
The cloud schemes described below therefore currently only impact radiation.
Diagnostic values for water vapor, cloud liquid water and cloud ice that include
sub-grid scale variability are parameterized (named qv, qc, qi).

The ICON-ECHAM physics includes two more cloud options : 
(1) a relative humidity based scheme and (2) a prognostic
total water variance scheme based on Tompkins (2002). 
They are not yet covered 
in this documentation.


%-------------------------------------------------------------------------

\section{Simple new diagnostic cloud scheme}
\label{sc:diag}

Clouds are distinguished by their origin into stratiform and convective clouds.

\subsection{Stratiform clouds}

The top-hat or box-function is one of the most simple assumed PDF.  It will be 
used to describe the distribution of water in a grid box.  The liquid and ice 
clouds are treated separately due to their different microphysical time-scales 
involved. 

\subsubsection{liquid cloud}

In figure \ref{fg:liquidPDF} such a box function distribution is illustrated.  Cloud cover
and mean specific liquid water can be calculated by integrating this box PDF with maximum 
PDF value $p$.  First the full PDF to get unity.

\begin{equation}
1 =  \int_{q_{bot}}^{q_{top}} p dq = 2 p \triangle q 
\end{equation}
and therefore
\begin{equation}
p = \frac{1}{2 \triangle q }.
\end{equation}

The width of the box distribution is $2 \triangle q$. 

The specific total water is written here as $\overline{q}=\overline{q_v} + \overline{q_l}$.  It can be diagnosed from the associated 
grid point variables $q_{v,grid}$ and $q_{l,grid}$ as $\overline{q}$ is conserved.  
Now we integrate the PDF from $q_{sat}$ (assumed constant) to get cloud cover $CC$
\begin{equation}
CC =  \int_{q_{sat}}^{q_{top}} p dq = \frac{q_{top}-q_{sat}}{2 \triangle q} 
= \frac{1}{2}\Big(\frac{\overline{q}-q_{sat}}{\triangle q}+1\Big).
\label{eq:cc}
\end{equation}

The grid-box mean specific liquid water $q_{l}$ can also be calculated.
\begin{equation}
\overline{q_l} =  \int_{q_{sat}}^{q_{top}} (q - q_{sat}) p dq = \frac{(q_{top}-q_{sat})^2}{4 \triangle q} 
= \frac{\triangle q}{4}\Big(\frac{\overline{q}-q_{sat}}{\triangle q}+1\Big)^2
\label{eq:ql}
\end{equation}
%
Note that 
\begin{equation}
q_{top} = \overline{q} + \triangle q 
\end{equation}
%
Equations \ref{eq:cc} and \ref{eq:ql} are valid for partial cloud cover, that is for $q_{bot} < q_{sat} < q_{top}$.
For $q_{sat} < q_{bot}$ trivial cloud properties can be written as
\begin{equation}
CC = 1
\end{equation}
and
\begin{equation}
\overline{q_l} =  \overline{q} - q_{sat}.
\end{equation}



\begin{figure}[t]
\centering
\includegraphics*[width=0.7\textwidth,bb=190 130 545 308] {plots/liquidPDF.pdf}
\caption{Box distribution of total water in a grid box that forms a liquid cloud.}
\label{fg:liquidPDF}
\end{figure}

\subsubsection{ice cloud}

The ICON microphysics works under the assumption that $q_i$ is horizontally homogeneious in a grid-box.
It allows for supersaturation with respect to ice and allows ice to survive in a subsaturated environment.
In the sub-grid cloud scheme we make the assumption that the grid-scale microphysics produces a mixture of
ice and vapor that is accurate also for the sub-grid scale microphysics.  That means that the current threshold
specific humidity $q_{thresh}$ is equal to (1) $q_{v,grid}$ that is seen my the grid-scale microphysics for supersaturated
environments and (2) $q_{sat,ice}$ for subsaturated environments.  This can be written as
\begin{equation}
q_{thresh} =  min(q_{v,grid}, q_{sat,ice}).
\end{equation}

Now we can write analogous equations for $CC$ and $q_i$ as done for the liquid phase by replacing $q_{sat,liq}$
with $q_{thresh}$.  This sub-grid ice cloud is only applied when grid-scale ice is predicted 
($q_{i,grid} > 10^{-6}$kg/kg).


\subsubsection{mixed phase cloud}

Mixed-phase liquid/ice stratiform clouds are treated by assuming that they occupy the same volume.  
The mixed-phase cloud cover is then the maximum of $CC_{liq}$ and $CC_{ice}$.  Note that if 
$\triangle q_{liq} = \triangle q_{ice}$ then $CC_{ice} > CC_{liq}$ following equ. \ref{eq:cc}.
 


\subsubsection{tuning parameters}

The width of the box function needs to be specified.  For liquid clouds we assume $\triangle q = 0.05 q_{sat,liq}$
and for ice clouds a narrower $\triangle q = 0.05 q_{sat,ice}$.  This corresponds to a threshold 
relative humidity of 95\%.


\subsection{Convective clouds}

The Tiedtke (1989) convection scheme provides detrainment properties that we are using to create a diagnostic anvil
(see figure \ref{fg:anvil}).  In particular three parameters calculated by the convection scheme are available:
detrainment rate $D_u$, updraft liquid water $q_{l,up}$ and ice water $q_{i,up}$.  The anvil cloud cover can
be estimated from
%
\begin{equation}
\frac{\partial CC}{t} = (1-CC) \frac{D_u}{\rho} - \frac{CC}{\tau_{decay}}.
\label{eq:decay}
\end{equation}
%
The time derivative is neglected to arrive at a diagnostic equation that can be solved for $CC$.  
%
\begin{equation}
CC= \frac{\frac{D_u}{\rho}}{\frac{D_u}{\rho} + \frac{1}{\tau_{decay}}}
\label{eq:decay2}
\end{equation}
%
The anvil decay time-scale $\tau_{diss}$ is currently set to 30min.  
Observations of anvil life times are on the order of a few hours.   
This decay time-scale should be dependent on environmental 
relative humidity (Tiedtke 1993, eq. 30-32).

\begin{figure}[t]
\centering
\includegraphics*[width=0.5\textwidth,bb=40 225 330 420] {plots/detrainment_anvil.pdf}
\caption{Detrainment terms from convection create an anvil.}
\label{fg:anvil}
\end{figure}

The updraft values $q_{l,up}$ and $q_{i,up}$ are used as in-cloud specific water and ice.  They are limited to $0.1*q_v$.
One might consider to write similar decay equations as in equ. \ref{eq:decay} for the updraft water values.


\subsection{Mixed stratifom/convective clouds}

If stratiform and convective clouds exist in the same grid-box, 
the maximum value for $CC$, $\overline{q_l}$ and $\overline{q_i}$ is used.


%-------------------------------------------------------------------------

\section{Prognostic cloud scheme}

An option to predict moments of the sub-grid cloud water distribution will be
developed.  


%-------------------------------------------------------------------------

\section{COSMO diagnostic cloud scheme}

The COSMO diagnostic cloud scheme has been implemented.  Details can be found in 
Axel Seifert's ``A short introduction to clouds in the COSMO model''.

\section{Technical aspects}

The namelist parameter ``inwp\_cldcover''
in namelist ``nwp\_phy\_ctl'' specifies the sub-grid cloud scheme with the following options.
\begin{enumerate}[start=0]
\item no clouds
\item diagnostic cloud cover
\item prognostic total water variance (not yet available)
\item clouds as in COSMO
\item clouds as in turbulence
\item grid-scale cloud cover [1 or 0]
\end{enumerate}
The default scheme is the diagnostic scheme described in section \ref{sc:diag}.

The code includes the following files.\\
\verb|atm_phy_nwp/mo_nh_interface_nwp.f90 |\\
\verb|shared/mo_physical_constants.f90    |\\
\verb|atm_phy_scheme/mo_cover_koe.f90     |\\
\verb|atm_phy_scheme/mo_cover_cosmo.f90   |\\
\verb|atm_phy_scheme/mo_cloud_diag.f90    |\\
\verb|atm_phy_scheme/mo_phyparam_turb.f90 |\\


%-------------------------------------------------------------------------

\section{Saturation specific humidity and relative humidity}

Special care needs to be taken in the calculation of saturation specific humidity 
over liquid $q_{sat}$ and similarly over ice (not shown).  Let's first define the specific humidity as
\begin{equation}
q = \epsilon \frac{e}{p-(1-\epsilon)e} ,
\end{equation}
with $\epsilon=\frac{R_d}{R_v}=0.622$, $e$ the vapor pressure, $p$ the total air pressure and 
$R_d$ and $R_v$ ideal gas constants of dry air and water vapor.

If we would write the saturation specific humidity simply by exchanging all $e$ with $e_{sat}$ 
\begin{equation}
q_{sat} = \epsilon \frac{e_{sat}}{p-(1-\epsilon)e_{sat}}.
\end{equation}
we could have a singularity when the denomiator becomes zero.  This is wrong.  It can be shown 
that consistent with the customary definition of relative humidity as
\begin{equation}
RH = \frac{e}{e_{sat}}
\end{equation}
the correct saturation specific humidity is
\begin{equation}
q_{sat} = \epsilon \frac{e_{sat}}{p-(1-\epsilon)e}.
\end{equation}
The only unfortunate fact is that this formula depends on $e$, the current specific humidity. 


%-------------------------------------------------------------------------

%\bibliography {/fe1-daten/mkoehler/papers-me/references/REFERENCES}
%\bibliographystyle {/fe1-daten/mkoehler/papers-me/references/wileyqj} %QJ


