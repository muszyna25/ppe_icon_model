\svnInfo $Id$
% --------------------------------------------------------------------------------
\chapter[ICON data in the SKY data bases of DWD]{ICON data in the\\SKY data bases of DWD}
\label{section:icon_in_sky}
% --------------------------------------------------------------------------------


GRIB data of the numerical weather prediction models are stored in the data base
SKY at DWD.
Documentation on the SKY system is available in the intranet of DWD at
%\url{IT/Messnetz/Technik $\rightarrow$ Datenmanagement (technisch) $\rightarrow$
%Management der DWD Fachdaten -Dokumentation $\rightarrow$ SKY}.
%\url{IT/Messnetz/Technik -> Datenmanagement (technisch) ->
%Management der DWD Fachdaten - Dokumentation -> SKY}.
{\tt IT/Messnetz/Technik $\rightarrow$ Datenmanagement (technisch) $\rightarrow$
Management der DWD Fachdaten -Dokumentation $\rightarrow$ SKY}.
Here, some remarks are given on the SKY categories for ICON data, and some
examples are given how to retrieve data from the data base.

\section{SKY categories for ICON}\label{sec_skycat}

In SKY the data is stored in different categories and data base subsystems.
These are identified by the cat=CAT\_NAME parameter.
The name of a category is made up of 4 parts:

\begin{center}
 \begin{minipage}{0.25\textwidth}
  \centering
  \textbf{\${model}\_\${run}\_\${type}\_\${suite}}
 \end{minipage}
\end{center}
 
run, type, and suite are general for all forecast models of DWD. They can have the 
following values:
\begin{itemize}
 \item \textbf{run}: \textbf{main} for main forecast runs,
                     \textbf{ass} for assimilation runs,
                     \textbf{pre} for pre-assimilation runs,
                     \textbf{const} for invariant data.
 \item \textbf{type}: \textbf{an} for analysis data,
                      \textbf{fc} for forecast data.
 \item \textbf{suite}: 
       \begin{itemize}
         \item \textbf{rout} for operational data in \emph{db=roma,}
         \item \textbf{para} or \textbf{para1} for pre-operational data in \emph{db=parma},
                       The category extension para1 denotes the data with EU nest
                       (starting at 12 UTC, 2015032612).
         \item \textbf{exp} or \textbf{exp1} for data from experiments in
                       \emph{db=numex}. The category extension exp1 is used for
                       experiments of the NUMEX wizard, a special NUMEX user.

                       Data from experiments is additionally
                       identified by the parameter \emph{exp=}$NUM$ where $NUM$ is
                       the experiment number.
       \end{itemize}
\end{itemize}

The ICON categories start with the string \textbf{ico} for ICON data on 
the native ICON grid, or with \textbf{icr} for data on a regular lat-lon grid.
Next follows a two-letter string to identify the domain of ICON; \textbf{gl} for the
global domain, \textbf{eu} for the nest over Europe. Further particulars of the category 
name differ for the global and nested domain. In case of the global domain, \textbf{gl} 
is followed by the mesh width of the model in units of 100 m, and then the number of levels 
preceeded by the letter l. As an example \textbf{icogl130l90} is on the native grid from a global 
model with a mesh width $13\,\mathrm{km}$ (grid R3B07) and 90 levels. \textbf{icrgl400l90} is data 
on a regular grid from a global model with mesh width $40\,\mathrm{km}$ (R2B06) and 90 levels. 
For the nested domain, the specification of the mesh width and number of levels is omitted. As an 
example, \textbf{icreu} is the ICON nest over Europe (with a mesh width of $6.5\,\mathrm{km}$ and 50 
levels), interpolated to a regular lat-lon grid.

Hence, the full category name for data from a global operational forecast run of ICON on a
regular grid will be \textbf{icrgl130l90\_main\_fc\_rout}. The initial analysis for this
run is in category \textbf{icogl130l90\_main\_an\_rout}.

\begin{note}
Since 2014-08-12 12 UTC ICON is running pre-operationally at DWD. Hence, forecast data
is available in the sky database \textbf{db=parma} in categories
\textbf{icogl130l90\_main\_fc\_para} and \textbf{icrgl130l90\_main\_fc\_para}.
\end{note}

\begin{note}
Since 2015-01-20 06 UTC the \emph{global} ICON model is running operationally at DWD.
Forecast data is available in the sky database \textbf{db=roma} in categories
\textbf{icogl130l90\_main\_fc\_rout} and \textbf{icrgl130l90\_main\_fc\_rout}.
\end{note}

\section{Retrieving ICON data from SKY}\label{sec_example}

Here we shall give several examples how to retrieve ICON data from SKY.
The parameter d specifies the reference or initial date, s is the forecast step, p the parameter,
and f the name of the GRIB data file.

\begin{itemize}
\item Retrieve the 2m temperature and dew point temperature 
 for forecast hours 3 to 78 every 3 hours of today's run at 00 UTC
 on the global domain from an ICON run on a R3B07 grid with 90 levels to file icon2mdat
\begin{skydb}
 read db=roma cat=icrgl130l90_main_fc_rout d=t00 s[h]=3/to/78/by/3 p=t_2m,td_2m bin f=icon2mdat
\end{skydb}

\item Retrieve the analysis of T on the native grid from yesterday 18 UTC:
\begin{skydb}
read db=roma cat=icogl130l90_main_an_rout d=t18-1d p=T gptype=0 bin f=t_icon_ana
\end{skydb}

\item Retrieve the 6, 12, 18, and 24 hour forecast of the 2m temperature from a forecast
run on 2012-06-28 at 00 UTC on the global domain from an ICON run on a R3B07 grid with 90 levels:

\begin{skydb}
read db=numex cat=icrgl130l90_main_fc_exp1 exp=901 d=2012062800 s[h]=6,12,18,24 p=t_2m bin f=t_2m_fc.grb
\end{skydb}

\item Retrieve wind components U and V at 300 hPa on the regular grid from a 24 hour forecast on
2013-10-03 at 00 UTC. lv=P specifies the level type as pressure levels. lv1=30000 specifies the level in Pa. 

\begin{skydb}
read db=numex cat=icrgl130l90_main_fc_exp1 exp=907 d=2013100300 s[h]=24 p=U,V lv=P lv1=30000 bin f=uvReg300hPa
\end{skydb}

\item Retrieve the analysis of U on the native grid:
\begin{skydb}
read db=numex cat=icogl130l90_main_an_exp1 exp=907 d=2013100300 p=U bin f=u_icon_ana
\end{skydb}

\item Retrieve temperature forecasts from 7 to 9 hours on the native grid:
\begin{skydb}
read db=numex cat=icogl130l90_main_fc_exp1 exp=907 d=2013100300 s[h]=7/to/9 p=T bin f=T_icon_07-09
\end{skydb}

\item Retrieve a 6 hour forecast on a regular grid on pressure levels. ICON was run on a 40 km
grid (R2B06).  Write reference date (d),
forecast step (s), level type (lv), value of first level (lv1), decoding date (dedat), and
store date (stdat) in information file icr.info.
\begin{skydb}
read db=numex cat=icrgl400l90_main_fc_exp exp=9323 d=2012010100 step[h]=6 lv=P f=icr06p bin info=metaData metaArray=d,s,p,lv,lv1,dedat,stdat sort=d,s,p,lv,lv1 infof=icr.info
\end{skydb}
In order to retrieve the same forecast on height levels, the level type must be changed to lv=HMSL.

\item Retrieve temperature in 850 hPa from a forecast on 2013-10-05 at 12 UTC:

\begin{skydb}
read db=numex cat=icrgl400l90_main_fc_exp1 exp=906 d=2013100512 p=T lv1=85000 lv=P bin f=t850_iconr
\end{skydb}

\item Retrieve all available time-invariant (constant) fields on the native grid and store them in the file const\_icongl. 
Write reference date (d), forecast step (s), level type (lv), value of first level (lv1), decoding date (dedat), 
and store date (stdat) in information file icr.info. It is important to set \textbf{invar=true}.

\begin{skydb}
read db=roma cat=icogl130l90_const_an_rout invar=true info=metaData metaArray=d,s,p,lv,lv1,dedat,stdat bin infof=icr.info f=const_icongl
\end{skydb}

\end{itemize}
