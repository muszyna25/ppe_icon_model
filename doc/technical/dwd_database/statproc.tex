\section{Statistically processed output fields}
\label{sec_statproc_fields}

\subsection{Time-averaged fields}

The quantities
\begin{note}
\begin{tabbing}
  \hspace{0.2\textwidth} \= \hspace{0.2\textwidth} \= \hspace{0.2\textwidth} \= \hspace{0.2\textwidth} \kill
  ALHFL\_S \>
  ASHFL\_S \>
  AUMFL\_S \>
  AVMFL\_S \\
  APAB\_S  \>
  ASOB\_S  \>
  ASOB\_T  \>
  ATHB\_S  \\
  ATHB\_T  \>
  ASWDIR\_S  \>
  ASWDIFS\_S  \>
  ASWDIFU\_S
\end{tabbing}
\end{note}

constitute time averages over the respective forecast time. The averaging process is performed from forecast start  
($t_{0}=0\,\mathrm{s}$) till forecast end. Thus, time averaged fields which are written to the database at $t=t_{i}$ 
contain averages for the elapsed time interval $[t_{0}, t_{i}]$.

Let $\Psi$ denote the instantaneous value of one of the above fields. The time average $\overline{\Psi}$ at time $t$ stored in the 
database is given as
\begin{align*}
 \overline{\Psi}(t) = \frac{1}{t}\int_{0}^{t} \Psi\, \mathrm{d}t  \quad \text{, for } t>0.
\end{align*}
For $t=0$, the average $\overline{\Psi}$ is equal to 0. 
If time averages are required for other time intervals $[t_{1},t_{2}]$, with $t_{1}>0$, these can be computed as follows:
\begin{align*}
 \overline{\Psi}(t_{2}-t_{1}) &= \frac{1}{t_{2}-t_{1}}\int_{t_{1}}^{t_{2}} \Psi\,\mathrm{d}t \\
                              &= \frac{1}{t_{2}-t_{1}} \left[\int_{0}^{t_{2}} \Psi\,\mathrm{d}t  - \int_{0}^{t_{1}} \Psi\,\mathrm{d}t \right] \\
                              &= \frac{1}{t_{2}-t_{1}} \left[ t_{2}\overline{\Psi}(t_{2}) - t_{1}\overline{\Psi}(t_{1}) \right]
\end{align*}
For this equation to work, it is of course necessary that the fields $\overline{\Psi}(t_{1})$ and $\overline{\Psi}(t_{2})$ are available from the database.



The averaging process is fully reflected by the field's GRIB2 metainfo. In order to check whether a field contains the desired time average, it is 
advisable to check the content of the GRIB2 keys listed in Table~\ref{tab_GRIB2avg}.
I.e.\ \texttt{productDefinitionTemplateNumber=8} indicates that the field in question is statistically processed. The statistical process itself 
is specified by the key \texttt{typeOfStatisticalProcessing}. The averaging interval (relative to the start of the forecast) is given by 
\begin{center}
$[\texttt{forecastTime}, \texttt{forecastTime+lengthOfTimeRange}]$. 
\end{center}
Since the averaging process starts at $t=0$, the key \texttt{forecastTime} 
is set to 0. 

\begin{longtable}{p{1.2cm}p{5.5cm}p{1.0cm}p{6.0cm}}
\captionabove[]{List of GRIB2 keys which provide information about the \emph{averaging} process}\label{tab_GRIB2avg}
\\
  \toprule
\multicolumn{1}{c}{\textbf{Octet(s)}}  &  \multicolumn{1}{c}{\textbf{Key}}  & \multicolumn{1}{c}{\textbf{Value}} & \multicolumn{1}{c}{\textbf{Meaning}} \\
\midrule
%%\endfirsthead
%%\caption[]{\emph{continued}}\\
%%\midrule
\endhead
\hline \multicolumn{4}{r}{\textit{Continued on next page}} \\
\endfoot
\endlastfoot
 8-9        &  \texttt{productDefinitionTemplateNumber}             &     8               &    Average, accumulation, extreme values or other statistically processed values at a horizontal level or in a horizontal layer in a continuous or non-continuous time interval   \\
 19-22      &  \texttt{forecastTime}                                &     0               &    Starting time of the averaging process relative to the reference time. \\
 47         &  \texttt{typeOfStatisticalProcessing}                 &     0               &    Average                                  \\
 50-53      &  \texttt{lengthOfTimeRange}                           &    \emph{variable}  &    Time range over which statistical processing is done \\
\bottomrule
\end{longtable}


\subsection{Accumulated fields}

The quantities
\begin{note}
\begin{tabbing}
  \hspace{0.2\textwidth} \= \hspace{0.2\textwidth} \= \hspace{0.2\textwidth} \= \hspace{0.2\textwidth} \kill
  RAIN\_GSP \>
  SNOW\_GSP \>
  RAIN\_CON \>
  SNOW\_CON \\
  TOT\_PREC  \>
  RUNOFF\_S  \>
  RUNOFF\_G
\end{tabbing}
\end{note}

are accumulated over the respective forecast time. The accumulation process is performed from forecast start  
($t_{0}=0\,\mathrm{s}$) till forecast end. Thus, fields which are written to the database at $t=t_{i}$ 
are accumulated for the elapsed time interval $[t_{0}, t_{i}]$.

Let $\Psi$ denote the instantaneous value of one of the above fields. The accumulation $\hat{\Psi}$ at time $t$ stored in the 
database is given as
\begin{align*}
 \hat{\Psi}(t) = \int_{0}^{t} \Psi\, \mathrm{d}t  \quad \text{, for } t>0.
\end{align*}
For $t=0$, the accumulation $\hat{\Psi}$ is equal to 0. 
If accumulations are required for other time intervals $[t_{1},t_{2}]$, with $t_{1}>0$, these can be computed as follows:
\begin{align*}
 \hat{\Psi}(t_{2}-t_{1}) &= \int_{t_{1}}^{t_{2}} \Psi\,\mathrm{d}t \\
                         &= \int_{0}^{t_{2}} \Psi\,\mathrm{d}t  - \int_{0}^{t_{1}} \Psi\,\mathrm{d}t \\
                         &= \hat{\Psi}(t_{2}) - \hat{\Psi}(t_{1})
\end{align*}
For this equation to work, it is of course necessary that the fields $\hat{\Psi}(t_{1})$ and $\hat{\Psi}(t_{2})$ are available from the database.

The accumulation process is fully reflected by the field's GRIB2 metainfo. In order to check whether a field contains the desired accumulation, 
it is advisable to check the content of the GRIB2 keys listed in Table~\ref{tab_GRIB2acc}.
I.e.\ \texttt{productDefinitionTemplateNumber=8} indicates that the field in question is statistically processed. The statistical process itself 
is specified by the key \texttt{typeOfStatisticalProcessing}. The accumulation interval (relative to the start of the forecast) is given by 
\begin{center}
$[\texttt{forecastTime},\texttt{forecastTime+lengthOfTimeRange}]$. 
\end{center}
Since the accumulation process starts at $t=0$, the key \texttt{forecastTime} 
is set to 0. 
\begin{longtable}{p{1.2cm}p{5.5cm}p{1.0cm}p{6.0cm}}
\captionabove[]{List of GRIB2 keys which provide information about the \emph{accumulation} process}\label{tab_GRIB2acc}\\
  \toprule
\multicolumn{1}{c}{\textbf{Octet(s)}}  &  \multicolumn{1}{c}{\textbf{Key}}  & \multicolumn{1}{c}{\textbf{Value}} & \multicolumn{1}{c}{\textbf{Meaning}} \\
\midrule
%%\endfirsthead
%%\caption[]{\emph{continued}}\\
%%\midrule
\endhead
\hline \multicolumn{4}{r}{\textit{Continued on next page}} \\
\endfoot
\endlastfoot
 8-9        &  \texttt{productDefinitionTemplateNumber}             &     8               &    Average, accumulation, extreme values or other statistically processed values at a horizontal level or in a horizontal layer in a continuous or non-continuous time interval   \\
 19-22      &  \texttt{forecastTime}                                &     0               &    Starting time of the accumulation process relative to the reference time. \\
 47         &  \texttt{typeOfStatisticalProcessing}                 &     1               &    Accumulation                                  \\
 50-53      &  \texttt{lengthOfTimeRange}                           &    variable         &    Time range over which statistical processing is done \\
\bottomrule
\end{longtable}



\subsection{Extreme value fields}

The quantities
\begin{note}
\begin{tabbing}
  \hspace{0.2\textwidth} \= \hspace{0.2\textwidth} \= \hspace{0.2\textwidth} \= \hspace{0.2\textwidth} \kill
  VMAX\_10M \>
  TMAX\_2M \>
  TMIN\_2M 
\end{tabbing}
\end{note}
contain extreme values, which are collected over $3$-hourly time windows, starting from the beginning of the forecast. 
After $3$ hours of forecast the fields are re-initialized with $0$ for the first time and the next $3$-hourly collection 
phase is started. This procedure is repeated till the end of the forecast.

Let $\Psi$ denote the instantaneous value of one of the above fields. The maximumu value $\Psi_{max}$ at time $t$ stored in the 
database is given as
\begin{align*}
 \Psi_{max}(t) = \max(\Psi(t),\Psi_{max}(t))  \quad \text{, for } t_{i}<t<t_{i}+3h
\end{align*}
Here, $t_{i}$ indicates the time when $\Psi_{max}$ was (re)-initialized the last time. For $t=0$, the extreme value $\Psi_{max}$ 
is equal to the instantaneous value $\Psi$. 

\paragraph{Please note:} Even though a 3 hour time window is used, the database contains hourly, 2-hourly and 3-hourly 
extreme value fields. This is because the extreme value fields are written to the database hourly, irrespective of the 
start/end of the 3-hourly time windows. Example: Extreme value fields which are written into the database after a 
forecast time of $5$ hours, contain extreme values collected over the last $2$ hours. On the other hand, extreme value fields 
written into the database after $6$ hours contain values collected over the last $3$ hours.
Thus, when dealing with those fields it is very important to check the GRIB2 keys listed in Table \ref{tab_GRIB2extreme}.

\texttt{productDefinitionTemplateNumber=8} indicates that the field in question is statistically processed. The statistical process itself 
is specified by the key \texttt{typeOfStatisticalProcessing}. The time interval (relative to the start of the forecast) over which the 
extreme value collection was performed is given by $[\texttt{forecastTime},\texttt{forecastTime+lengthOfTimeRange}]$. 
Since the collection precess is restarted every $3$ hours, the key \texttt{forecastTime} can differ from 0. 

\begin{longtable}{p{1.2cm}p{5.5cm}p{1.0cm}p{6.0cm}}
\captionabove[]{List of GRIB2 keys which provide information about the \emph{extreme value} process}\label{tab_GRIB2extreme}
  \toprule
\multicolumn{1}{c}{\textbf{Octet(s)}}  &  \multicolumn{1}{c}{\textbf{Key}}  & \multicolumn{1}{c}{\textbf{Value}} & \multicolumn{1}{c}{\textbf{Meaning}} \\
\midrule
%%\endfirsthead
%%\caption[]{\emph{continued}}\\
%%\midrule
\endhead
\hline \multicolumn{4}{r}{\textit{Continued on next page}} \\
\endfoot
\endlastfoot
 8-9        &  \texttt{productDefinitionTemplateNumber}             &     8               &    Average, accumulation, extreme values or other statistically processed values at a horizontal level or in a horizontal layer in a continuous or non-continuous time interval   \\
 19-22      &  \texttt{forecastTime}                                &    \emph{variable}  &    Starting time of the statistical process relative to the reference time. \\
 47         &  \texttt{typeOfStatisticalProcessing}                 &     2,3             &    Maximum/Minimum                                  \\
 50-53      &  \texttt{lengthOfTimeRange}                           &    \emph{variable}  &    Time range over which statistical processing is done \\
\bottomrule
\end{longtable}

