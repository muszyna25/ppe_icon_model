\documentclass[a4paper,twoside,10pt,DIV13,BCOR=5mm]{scrbook}

\usepackage[english]{babel}
\usepackage{float}
\usepackage{xparse}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{pgfplots,pgfplotstable}
\usepackage{colortbl}
%\usepackage[notoday,nofancy]{svninfo}

\usepackage[nottoc]{tocbibind}     %--- adds bibliography to toc 
% --- but without toc itself [nottoc] 
\usepackage[round,sort,comma,authoryear]{natbib} %--- creates bibliography; author-year with curly brackets within the text
\usepackage[font={it,sf}]{subcaption}  %--- simplifies putting pictures side by side
\usepackage{longtable}
\usepackage{multirow}
\usepackage{tabularx}
\usepackage{supertabular}
\usepackage{booktabs}    % to give tables a more professional look
\usepackage{rotating}    % rotate column labels
\usepackage{xcolor}
\usepackage{listings}
\usepackage{hyperref}    % ability to create hyperlinks within the document
\usepackage{vhistory}
\usepackage{tikz}
\usepackage{etex}
\usepackage{xargs}
\usepackage{xstring}
\usepackage{enumitem}
\usepackage[strict]{changepage} % for adjustwidth environment
\usepackage{framed}
\usepackage{array}
\usepackage[titletoc]{appendix}
\usepackage{soul}
\usepackage[T1]{fontenc}
\usepackage{scrpage2}
\usepackage{environ}
\usepackage{pgf}
\usepackage{pgffor}
\usepackage[toc,section=chapter]{glossaries}
\usepackage{ltablex}

\usetikzlibrary{calc}
\usetikzlibrary{matrix}

% left-aligned fixed-width table column
\newcolumntype{P}[1]{>{\raggedright\arraybackslash}p{#1}}


% define some colors
\definecolor{darkred}{rgb}{0.5,0.,0.}
\definecolor{darkblue}{rgb}{0.,0.,0.6}
\definecolor{darkgreen}{rgb}{0.,0.25,0.}
\definecolor{darkgrey}{rgb}{0.7,0.75,0.71}
\definecolor{Gray}{gray}{0.9}
\definecolor{DWDblue}{RGB}{47,79,162}

% textcolors
\newcommand{\tred}{\textcolor{red}}
\newcommand{\tblu}{\textcolor{blue}}
\newcommand{\degree}{{\circ}}
\newcommand{\km}{\text{km}}
\newcommand{\m}{\text{m}}


% customize hyperref
\hypersetup{colorlinks, linkcolor=darkblue, citecolor=blue, urlcolor=darkgreen, linktoc=all}

%\renewcommand{\sffamily}{\fontfamily{DejaVuSans-TLF}\selectfont}

% change komafont sections from sansserif to serif
\setkomafont{sectioning}{\normalfont\normalcolor\bfseries}

% Select Sans-Serif DejaVu font
\newenvironment{sansserif}{\fontfamily{DejaVuSans-TLF}\selectfont}{\par}

% Fortran environment
\lstnewenvironment{fortran}%
{\lstset{language=[95]Fortran,%
    basicstyle=\ttfamily\footnotesize\color{darkgreen},%
    breaklines=true,%
    commentstyle=\ttfamily\color{blue},%
    emptylines=0,%
    keywordstyle=\color{black}\ttfamily\bfseries,%
    backgroundcolor=\color{darkgrey!5},
    framexleftmargin=4mm,%
    frame=shadowbox,%
    rulesepcolor=\color{darkgreen}}}
{}


% Sky environment
\lstnewenvironment{skydb}%
{\lstset{language=SQL,%
    basicstyle=\ttfamily\footnotesize\color{black},%
    breaklines=true,%
    commentstyle=\ttfamily\color{blue},%
    emptylines=0,%
    keywordstyle=\color{black}\ttfamily\bfseries,%
    backgroundcolor=\color{darkgrey!5},
    framexleftmargin=4mm,%
    frame=shadowbox,%
    rulesepcolor=\color{darkgreen}}}
{}

% LaTeX macros that are later used to disable/enable rows in the
% tables of output fields (global/local domain):
\newcommand{\onlyglb}[1]{#1}
\newcommand{\onlyloc}[1]{#1}

\newcommand{\new}[1]{}
\newcommand{\pressurelevelsTriangular}{}
\newcommand{\pressurelevelsRegular}{}
\newcommand{\heightlevelsRegular}{}

% macro: new page, until we are on a left page
\newcommand*\cleartoleftpage{%
  \clearpage
  \ifodd\value{page}\hbox{}\newpage\fi
}

\newcolumntype{x}[1]{%
  >{\centering\hspace{0pt}}p{#1}}%


% LaTeX macro storing an array of strings
%
% individual entries can be accessed by
%   \pgfmathparse{{\storedContent}[\i]}\pgfmathresult
\newcommand{\storedContent}{}
\makeatletter
\let\storedContent\@empty
\newcommand{\listappend}[1]{%
    \ifx\storedContent\@empty
     \g@addto@macro\storedContent{#1}%
    \else
     \g@addto@macro\storedContent{, #1}%
    \fi 
}
\makeatother

% macros storing colors in "storedContent" array
% ... these are then used in the timeline of model changes.
\definecolor{colorBlue}{rgb}{0.,0.,1.}
\definecolor{colorRed}{rgb}{1.,0.,0.}
\newcommand{\colorA}{\listappend{"0.,0.,1."}}
\newcommand{\colorB}{\listappend{"1.,0.,0."}}


\setkomafont{captionlabel}{\sffamily\bfseries}
\setkomafont{caption}{\sffamily}
\setcaphanging


% sign function
\newcommand{\sgn}{\operatorname{sgn}}

% \newcommand{\markRed}{\tikz \fill[red!60] (0,0) rectangle (0.08,0.8em);}
% \newcommand{\markBlue}{\tikz \fill[blue!80] (0,0) rectangle (0.08,0.8em);}
% \newcommand{\markWhite}{\tikz \fill[white!100] (0,0) rectangle (0.08,0.8em);}

\newcommand{\markRed}{\begin{tikzpicture}[baseline,scale=0.15] 
                        \fill[red!60,draw=black] (0.1,0) -- (1,0) -- (1,1.7) -- cycle;
                        \fill[red!60,draw=black] (0,0.3) -- (0,2) -- (0.9,2) -- cycle;
                      \end{tikzpicture}}
\newcommand{\markBlue}{\begin{tikzpicture}[baseline,scale=0.15] 
                        \fill[blue!60,draw=black] (0,0)  rectangle ++(1,0.9);
                        \fill[blue!60,draw=black] (0,1.1) rectangle ++(1,0.9);
                      \end{tikzpicture}}
\newcommand{\markWhite}{\begin{tikzpicture}[baseline,scale=0.15] 
                        \fill[white!100,draw=white] (0.0,0) rectangle ++(1,2);
                      \end{tikzpicture}}


%% Macro for indicating whether field is available on native grid
%% (tri), lat-lon grid (ll), or both
%
% This is using LaTeX 3 to trim white space around macro arguments!
\newcommand{\groupsinner}[2]{
  \IfEqCase{#1}{%
      {tri}{%
           \IfEqCase{#2}{%
           {ll}{\markRed\hspace*{0.1em}\markBlue}}      %group (tri,ll)
           [\markRed\hspace*{0.1em}\markWhite]          %group (tri)
      }%
  }[%
           \IfEqCase{#2}{%
           {ll}{\markWhite\hspace*{0.1em}\markBlue}}     %group (ll)
  ]
}
%%% Now we go with LaTeX3
\ExplSyntaxOn
\NewDocumentCommand{\groups}{ O{none} O{none} }
 {
  \latex_groups_node:nn
   { \tl_trim_spaces:n { #1 } }
   { \tl_trim_spaces:n { #2 } }
 }
\cs_set_eq:NN \latex_groups_node:nn \groupsinner
\cs_generate_variant:Nn \latex_groups_node:nn { xx }
\ExplSyntaxOff

% width of column containing grid native/lon-lat marks
\newcommand{\markcolwidth}{0.50cm}
% longtable header settings
\newenvironment{vartable}[1]{%
\begin{longtable}{%
@{}p{\markcolwidth}%
@{\hskip 0.05in}%
p{2.0cm}%
>{\small\raggedright}p{5cm}<{\normalsize}%
p{1.4cm}%
p{1.1cm}p{0.9cm}p{1cm}p{1cm}}#1\\
  \toprule
&\multicolumn{1}{c}{\begin{sideways}\textbf{ShortName}\end{sideways}}  &  \multicolumn{1}{c}{\rb{\textbf{Description}}}  & \multicolumn{1}{l}{\begin{sideways}\textbf{Discipline}\end{sideways}\,\,\begin{sideways}\bf{Category}\end{sideways}\,\,\begin{sideways}\bf{Number}\end{sideways}}  & \begin{sideways}\bf{Lev-Typ 1/2}\end{sideways}  & \begin{sideways}\bf{stepType}\end{sideways} & \begin{sideways}\bf{LL IntpType}\end{sideways} &\begin{sideways}\bf{Unit}\end{sideways}\\
\midrule

\endfirsthead
\caption[]{\emph{continued}}\\
\midrule
\endhead
\hline \multicolumn{8}{r}{\textit{Continued on next page}\hspace*{2em}} \\
\endfoot
\endlastfoot
}%
{%
  \bottomrule
\end{longtable}}

%
%
% mark Namelists
% - im Fliesstext:
\newcommand{\nml}[1]{\texttt{#1}}

\addtolength{\skip\footins}{2em} % Länge zwischen Fußnotenbereich und Text

% environment derived from framed.sty: see leftbar environment definition
\definecolor{formalshade}{rgb}{0.95,0.95,1}

\newenvironment{note}{%
  \def\FrameCommand{%
    \hspace{1pt}%
    {\color{darkblue}\vrule width 2pt}%
    {\color{formalshade}\vrule width 4pt}%
    \colorbox{formalshade}%
  }%
  \MakeFramed{\advance\hsize-\width\FrameRestore}%
  \noindent\hspace{-4.55pt}% disable indenting first paragraph
  \begin{adjustwidth}{}{7pt}%
%  \vspace{-2pt}\vspace{-2pt}%
}
{%
  %\vspace{2pt}%
  \end{adjustwidth}\endMakeFramed%
}


%\parskip0.4ex plus0.2ex minus0.3ex
\setlength{\parskip}{0.2cm plus0.1cm minus0.1cm}
\setlength{\parindent}{0.0em}

\includeonly{./glossary,
             ./preface_title_toc,
             ./preface_intro,
             ./model_timeline,
             ./analysis,
             ./input,
             ./grid_geometry,
             ./output_GRIB2_global,
             ./output_GRIB2_nest,
             ./icon_in_sky,
             ./appendix,
             ./output_statproc,
             ./output_description,
             ./quote,
             ./cosmo_eu_fields.tex,
             ./backmatter}
 



% code for generating a vertical timeline
% http://tex.stackexchange.com/a/28452/13304
\makeatletter
\let\matamp=&
\catcode`\&=13
\makeatletter
\def&{\iftikz@is@matrix
  \pgfmatrixnextcell
  \else
  \matamp
  \fi}
\makeatother

\newcounter{lines}
\def\endlr{\stepcounter{lines}\\}

\newcounter{vtml}
\setcounter{vtml}{0}

\newif\ifvtimelinetitle
\newif\ifvtimebottomline
\tikzset{description/.style={
  column 2/.append style={#1}
 },
 timeline color/.store in=\vtmlcolor,
 timeline color2/.store in=\vtmlcolortwo,
 timeline color=red!80!black,
 timeline color2=red!80!black,
 timeline color st/.style={fill=\vtmlcolor,draw=\vtmlcolor},
 timeline color st2/.style={fill=\vtmlcolortwo,draw=\vtmlcolortwo},
 add bottom line/.is if=vtimebottomline,
 add bottom line=false,
 line offset/.store in=\lineoffset,
 line offset=4pt,
}

\NewEnviron{vtimeline}[1][]{%
\setcounter{lines}{1}%
\stepcounter{vtml}%
\begin{tikzpicture}[column 1/.style={anchor=east},
 column 2/.style={anchor=west},
 minimum size=1.8ex,
 row sep=1ex,
 column sep=2em,
 #1
]
\matrix(vtimeline\thevtml)[matrix of nodes,nodes={anchor=north west,align=left}]{\BODY};
\pgfmathtruncatemacro\endmtx{\thelines-1}
\path[timeline color st, thick] 
($(vtimeline\thevtml-1-1.north east)!0.42!(vtimeline\thevtml-1-2.north west)$)--
($(vtimeline\thevtml-\endmtx-1.south east)!0.42!(vtimeline\thevtml-\endmtx-2.south west)$);
\path[timeline color st2, thick] 
($(vtimeline\thevtml-1-1.north east)!0.58!(vtimeline\thevtml-1-2.north west)$)--
($(vtimeline\thevtml-\endmtx-1.south east)!0.58!(vtimeline\thevtml-\endmtx-2.south west)$);
\foreach \x in {1,...,\endmtx}{
 \pgfmathparse{{\storedContent}[\x-1]};
 \definecolor{ballcolor}{rgb}{\pgfmathresult}
 \node[circle,timeline color st, inner sep=0.15pt, draw=white, fill=ballcolor, thick, yshift=-0.75em] 
 (vtimeline\thevtml-c-\x) at 
 ($(vtimeline\thevtml-\x-1.north east)!0.5!(vtimeline\thevtml-\x-2.north west)$){};
 \draw[timeline color st,thick,color=ballcolor](vtimeline\thevtml-c-\x.west)--++(-5pt,0);
 }
 \ifvtimebottomline%
   \draw[timeline color st, thick]([yshift=-\lineoffset]vtimeline\thevtml.south west)--
  ([yshift=-\lineoffset]vtimeline\thevtml.south east);
 \else%
   \relax%
 \fi%
\end{tikzpicture}
}
%--------------------- end of timeline code ------------------%


%----------------------- create glossary ---------------------%
\makeglossaries
%-------------------------------------------------------------%


% ------------------ start of document -----------------------%
\begin{document}

\setcounter{tocdepth}{3}     %--- maximum toc depth

\include{./glossary}
\pagestyle{scrheadings}

\renewcommand{\chaptermark}[1]{%
  \markboth{\chaptername
    \ \thechapter.\ #1}{}}

\renewcommand{\sectionmark}[1]{
  \markright{\thesection.\ #1}
}

% --- Erhoehung des vertikalen Abstandes zwischen den Zeilen eines Arrays
\renewcommand{\arraystretch}{1.5}

% --- Auswahl der Formatierung des Literaturverzeichnisses (deutsche Version), erstellt mit custom-bib package
% \bibliographystyle{plain}
% \bibliographystyle{diss_bibstyle.bst}
\bibliographystyle{jas99}

% --- search path for figures
\graphicspath{{./pics/}}
% ----------------------------------------------------------------%

\frontmatter     %--- aendert Zahlen von Arabisch auf roemisch

% ---------------- Generate title page ---------------------%
% ------- generate version history page --------------------%
\begin{titlepage}
  \include{./preface_title_toc}
\end{titlepage}
% ----------------------------------------------------------------%

% --------------------------------------------------------------------------------
\include{./quote}
% --------------------------------------------------------------------------------

\newpage
\pdfbookmark{\contentsname}{toc}
\tableofcontents              %--- generate table of contents

% remove chapter number from header for abstracts
\renewcommand{\chaptermark}[1] {
  \markboth{#1}{}
}


% shifting table captions...
\newcommand{\rb}[1]{\raisebox{4.0ex}[0pt]{#1}}

% use default again
\renewcommand{\chaptermark}[1]{%
  \markboth{\chaptername
    \ \thechapter.\ #1}{}}

\mainmatter                   %--- Zurcksetzen der Nummerierung auf arabisch



% --------------------------------------------------------------------------------
\include{./preface_intro}
% --------------------------------------------------------------------------------

% --------------------------------------------------------------------------------
\include{./model_timeline}
% --------------------------------------------------------------------------------

% --------------------------------------------------------------------------------
\include{./grid_geometry}
% --------------------------------------------------------------------------------

% --------------------------------------------------------------------------------
\include{./input}
% --------------------------------------------------------------------------------

% --------------------------------------------------------------------------------
\include{./analysis}
% --------------------------------------------------------------------------------

% --------------------------------------------------------------------------------
\chapter[Global output fields: Forecast runs]{Global output fields:\\ Forecast runs}

\input{./output_GRIB2_global}

% --------------------------------------------------------------------------------
\chapter[EU Nest output fields: Forecast runs]{EU Nest output fields:\\ Forecast runs}
\label{nest:chap_forecast_runs}
\input{./output_GRIB2_nest}
%\input{./cosmo_eu_fields.tex}

% --------------------------------------------------------------------------------
\chapter{Output fields for soil moisture analysis~SMA}
\label{output_for_sma}
\input{./output_GRIB2_sma}


% --------------------------------------------------------------------------------
\chapter{Extended description of available output fields}

\input{./output_description}


% --------------------------------------------------------------------------------
\chapter[Remarks on statistical processing and horizontal interpolation]{Remarks on statistical processing and horizontal interpolation}

\input{./output_statproc}
% --------------------------------------------------------------------------------



% --------------------------------------------------------------------------------
\include{./icon_in_sky}
% --------------------------------------------------------------------------------

\begin{appendices}
\include{./appendix}  %--- Einbinden der Appendix
\end{appendices}

\backmatter
\bibliography{litera.bib} %--- Create list of references

% remove chapter number from header for Acknowledgements
\renewcommand{\chaptermark}[1] {
  \markboth{#1}{}
}

% use default again
\renewcommand{\chaptermark}[1]{%
  \markboth{\chaptername
    \ \thechapter.\ #1}{}}

%----------------------- print glossary ----------------------%
\printglossaries
%-------------------------------------------------------------%


% --------------------------- Backside of document -------------------------------
\newpage
\cleartoleftpage
\include{./backmatter}
% --------------------------------------------------------------------------------


% --------------------------------------------------------------------------------
% --------------------------------------------------------------------------------
%\cleardoublepage
% \section*{Database documentation: list of todos}
% --------------------------------------------------------------------------------
% --------------------------------------------------------------------------------

% \begin{itemize}
%   \item EU nest: ''Urstart'' fields must be contained in the $VV=0$ list.
%   \item lake variables: ask Dimitri if these fields could be changed
%     from RBF interpolation to nearest-neighbor.
%   \item \st{EU nest, output of wind gusts hourly until 78h, afterwards 3
%     hourly:  Output of VMAX\_10M is 3-hourly for $VV>78h$. The
%     sampling interval should also be changed to 3h after $VV>78h$.}
%   \item \st{Create two additional timing diagrams like}
%     \ref{fig:forecast_length_global} \st{for the EU nest: One illustration for
%     native grid and one for the regular output grid.}
%   \item Questions for the ICON migration group:
%         \begin{itemize}
%           \item QR, QS necessary for lon-lat?
%           \item Q\_SEDIM required?
%           \item QV\_2M (lat-lon) required?
%           \item SOBS\_RAD, THBS\_RAD (lat-lon) required?
%           \item TQC\_DIA, TQI\_DIA ?
%           \item REL\_HUM on height levels required?
%           \item CAPE\_ML required?
%           \item CAPE\_CON (lat-lon) required?
%           \item FR\_ICE (lat-lon) required?
%           \item How should DTKE\_CON be treated on the EU nest, native grid?
%         \end{itemize}
%   \item \st{Height-level interpolated pressure: L1/L2 are 102/255 in the COSMO documentation.}
%   \item DTKE\_CON: not consistent with namelist.
% \end{itemize}


\end{document}
