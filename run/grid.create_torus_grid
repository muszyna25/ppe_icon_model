#!/bin/ksh
#-----------------------------------------------------------------------------
#
# Leonidas Linardakis, MPI-M, 2009-11
#
#-----------------------------------------------------------------------------
command=create_torus
parameterFile=NAMELIST_TORUS_GRID
commandFile=command.grid
run_commmand="$bindir/grid_command"
#-----------------------------------------------------------------------------

#-----------------------------------------------------------------------------
# absolute paths of directories
GRIDDIR=${basedir}/grids            # graphs, grids and patches
WRKDIR=$GRIDDIR
#-----------------------------------------------------------------------------
# the work directory will be created, if not already there
if [ ! -d $WRKDIR ]; then
    mkdir -p $WRKDIR
fi
#
cd $WRKDIR
#-----------------------------------------------------------------------------
# Define torus parameters
# Note that to match a square cell of area dx*dy
# use triangles of edge length = 2/(3**1/4)*SQRT(dx*dy) ~ 1.5*SQRT(dx*dy)
# use time step < 1.8*(edge length in km)/SQRT(3)       ~ (edge length in km)
#
# Naming convention for grid file:
# - template: torus_grid_x{no. of columns}_y{no. of rows}_e{edge length with unit}.nc
# - example : torus_grid_x64_y64_e120km.nc
#
cat > $parameterFile << EOF
&torus_grid_parameters
    x_no_of_columns = 64       ! even and >=4 (2 does not work for 2nd order diffusion op.)
    y_no_of_rows    = 64       ! even and >=4 (2 does not work for 2nd order diffusion op.)
    edge_length     = 120000.0 ! [m] 
    x_center        = 0.0
    y_center        = 0.0
    out_file_name   = 'torus_grid_x64_y64_e120km.nc'
    unfolded_torus_file_name = 'unfoldedTorus_grid.nc'
    ascii_filename  = 'torus_grid.ascii'
/
EOF

#-----------------------------------------------------------------------------
echo $command $parameterFile > $commandFile
${start} $run_commmand
#-----------------------------------------------------------------------------
