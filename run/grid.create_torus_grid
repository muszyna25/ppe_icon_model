#!/bin/ksh
#-----------------------------------------------------------------------------
#
# Leonidas Linardakis, MPI-M, 2009-11
#
#-----------------------------------------------------------------------------
command=create_torus
parameterFile=NAMELIST_TORUS_GRID
commandFile=command.grid
run_commmand="$bindir/grid_command"
#-----------------------------------------------------------------------------

#-----------------------------------------------------------------------------
# absolute paths of directories
GRIDDIR=${basedir}/grids            # graphs, grids and patches
WRKDIR=$GRIDDIR
#-----------------------------------------------------------------------------
# the work directory will be created, if not already there
if [ ! -d $WRKDIR ]; then
    mkdir -p $WRKDIR
fi
#
cd $WRKDIR
#-----------------------------------------------------------------------------
# Define torus parameters
# Note that to match a square cell of size dx*dy
# use triangles of edge length = 2/(3**1/4)*SQRT(dx*dy) ~ 1.5*SQRT(dx*dy)
# use time step < 1.8*edge_length[km]/SQRT(3) 
#
# Naming convention for grid file: torus_grid_r{resolution_in_m}_s{grid_size}.nc
cat > $parameterFile << EOF
&torus_grid_parameters
    y_no_of_rows = 2000
    x_no_of_columns = 2000
    edge_length = 100.0
    x_center = 0.0
    y_center = 0.0
    out_file_name = 'torus_grid_r100s2000.nc'
    unfolded_torus_file_name = 'unfoldedTorus_grid.nc'
    ascii_filename = 'torus_grid.ascii'
/
EOF

#-----------------------------------------------------------------------------
echo $command $parameterFile > $commandFile
${start} $run_commmand
#-----------------------------------------------------------------------------
