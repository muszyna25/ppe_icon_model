#! /bin/ksh
#-----------------------------------------------------------------------------
# Checks the consistency of a triangular grid and returns some statistics
# Leonidas Linardakis, MPI-M, 2009-11
#-----------------------------------------------------------------------------
level=$1
#-----------------------------------------------------------------------------
command=check_grid
command=grid_statistics
commandFile=command.grid
run_commmand="$bindir/grid_command"
latex_name=grid_table_0$level
latex_file=$thisdir/$latex_name
#-----------------------------------------------------------------------------

#-----------------------------------------------------------------------------
cat > "${latex_file}_verts.tex" << EOF
\documentclass[a4paper,10pt]{book}
\usepackage[top=0cm, bottom=0cm, left=0cm, right=0cm]{geometry}
\usepackage{rotating}
\begin{document}
\begin{sidewaystable}
\begin{center}
\begin{tabular}{|l|c|c|c|}
\hline
grid & dual bary-   & dual cell & dual area \\\\
     & center max   & max edge  & max ratio \\\\
     & distance(km) &  ratio    &           \\\\
\hline
EOF
#-----------------------------------------------------------------------------
#-----------------------------------------------------------------------------
cat > "${latex_file}_edges.tex" << EOF
\documentclass[a4paper,10pt]{book}
\usepackage[top=0cm, bottom=0cm, left=0cm, right=0cm]{geometry}
\usepackage{rotating}
\begin{document}
\begin{sidewaystable}
\begin{center}
\begin{tabular}{|l|c|c|c|c|c|}
\hline
grid &  adj.cell  & dual adj.  &  edge & dual edge & max       \\\\
     &  max area  & cell max   & max   & max ratio & cell-edge \\\\
     &    ratio   & area ratio & ratio &           & ratio     \\\\
\hline
EOF
#-----------------------------------------------------------------------------
#-----------------------------------------------------------------------------
cat > "${latex_file}_cells.tex" << EOF
\documentclass[a4paper,10pt]{book}
\usepackage[top=0cm, bottom=0cm, left=0cm, right=0cm]{geometry}
\usepackage{rotating}
\begin{document}
\begin{sidewaystable}
\begin{center}
\begin{tabular}{|l|c|c|c|c|c|c|}
\hline
grid  & max  & max cell & max cell & max cell   & max bary-    & max bary-   \\\\
      & area & edge     & dual edge& cell edge  & center       & center diff \\\\
      &ratio &  ratio   & ratio    & ratio      & distance(km) & ratio       \\\\
\hline
EOF
#-----------------------------------------------------------------------------
cd ${basedir}/grids
echo $command  iconR2B0${level}-base.nc \"$latex_file\" > $commandFile
#${run_commmand}
#-----------------------------------------------------------------------------
cd ${basedir}/grids
echo $command  iconR2B0${level}-grid.nc \"$latex_file\" > $commandFile
${run_commmand}
#-----------------------------------------------------------------------------
# cd ${basedir}/grids
# echo $command  iconR2B0${level}-spring_local.nc \"$latex_file\" > $commandFile
# ${run_commmand}
# #-----------------------------------------------------------------------------
# cd ${basedir}/grids
# echo $command  iconR2B0${level}-spring_center.nc \"$latex_file\" > $commandFile
# ${run_commmand}
# #-----------------------------------------------------------------------------
# cd ${basedir}/grids
# echo $command  iconR2B0${level}-symm.nc \"$latex_file\" > $commandFile
# ${run_commmand}
# #-----------------------------------------------------------------------------
# cd ${basedir}/grids
# echo $command  iconR2B0${level}-grid_opt.90.nc \"$latex_file\" > $commandFile
# ${run_commmand}
# #-----------------------------------------------------------------------------
# cd ${basedir}/grids
# echo $command  iconR2B0${level}-grid_opt_new.nc \"$latex_file\" > $commandFile
# ${run_commmand}
# #-----------------------------------------------------------------------------
# # cd ${basedir}/grids
# # echo $command  iconR2B0${level}-grid_spr0.90.nc  > $commandFile
# # ${run_commmand}
# #-----------------------------------------------------------------------------
# cd ${basedir}/grids
# echo $command  iconR2B0${level}-r_ref.nc \"$latex_file\" > $commandFile
# ${run_commmand}
#-----------------------------------------------------------------------------
# cd ${basedir}/grids_local
# echo $command  iconR2B0${level}-opt_spring.nc \"$latex_file\" > $commandFile
# ${run_commmand}
# #-----------------------------------------------------------------------------
# cd ${basedir}/test_icon_opt_grids
# echo $check_command   icon_grids_0${level}.nc  NULL > $commandFile
# ${run_commmand}
#-----------------------------------------------------------------------------

#-----------------------------------------------------------------------------
cd $thisdir

#-----------------------------------------------------------------------------
if [[ $command == "check_grid" ]] ; then
  exit 0
fi

#-----------------------------------------------------------------------------
cat >> "${latex_file}_verts.tex" << EOF
\hline
\end{tabular}
\end{center}
\end{sidewaystable}
\end{document}
EOF
#-----------------------------------------------------------------------------
cat >> "${latex_file}_edges.tex" << EOF
\hline
\end{tabular}
\end{center}
\end{sidewaystable}
\end{document}
EOF
#-----------------------------------------------------------------------------
cat >> "${latex_file}_cells.tex" << EOF
\hline
\end{tabular}
\end{center}
\end{sidewaystable}
\end{document}
EOF
#-----------------------------------------------------------------------------

#-----------------------------------------------------------------------------
pdflatex "${latex_name}_verts"
acroread "${latex_name}_verts.pdf" &
#-----------------------------------------------------------------------------
pdflatex "${latex_name}_edges"
acroread "${latex_name}_edges.pdf" &
#-----------------------------------------------------------------------------
pdflatex "${latex_name}_cells"
acroread "${latex_name}_cells.pdf" &
#-----------------------------------------------------------------------------
