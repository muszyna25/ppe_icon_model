#!/bin/ksh
#--------------------------------------------------------------------------------
#
# _bb_table_Description_  AMIP experiment
# _bb_table_Model_        non-hydrostatic atmosphere with ECHAM physics

#--------------------------------------------------------------------------------
#
# 1. Define the experiment and the files to be checked
#
# EXPERIMENT is the name of the experiment, that defines the experiment descriptor
# file run/exp.<EXPNAME>. EXPNAME is used also for:
# - the output directory name: experiments/<EXPNAME>
# - the output  file names: <EXPNAME>_<TYPE>_<DATE>.nc
# - the restart file names: 
#
## For this test a separate experiment name is needed. Therefore a soft-link
## is created for the new name exp.atm_amip_tolerance_test.
#rm -f exp.atm_amip_tolerance_test
#ln -s exp.atm_amip_test exp.atm_amip_tolerance_test
#
# NOTE:
# For the time being the tolerance test on daint needs different namelist settings
# than the atm_amip_test.
# As soon as this problem is solved the commented soft-link from above should be
# used again.
#
export EXPERIMENT='atm_amip_tolerance_test'

# TYPES is a list of names identifying the files <EXPNAME>_<TYPE>_<DATE>.nc
# to be checked.
#
export TYPES='atm_2d_ml atm_3d_ml phy_3d_ml lnd_ml'

# DATES is a list of dates identifying the files <EXPNAME>_<TYPE>_<DATE>.nc
# to be checked.
#
export DATES='19790101T000000Z 19790101T000400Z 19790101T000800Z 19790101T001200Z 19790101T001600Z'

# RESTART_DATE defines the date and time from which restarts should be performed.
# 
export RESTART_DATE='19790101T000800Z'

#--------------------------------------------------------------------------------
# 
# 2. Define the checksuite mode
#
# u = update test
# r = restart test
# n = nproma test
# m = mpi test
# o = omp test
# t = tolerance test
#
# default: MD='rnmo'
#
export MD='t'

#--------------------------------------------------------------------------------
# 
# 3. Launch the checksuite from run/

rundir=`pwd`
cd checksuite.icon-dev

# load python packages
case $HOST in
    *daint*)
        module load daint-gpu
        module load cray-python/3.6.5.7
        module load PyExtensions/3.6.5.7-CrayGNU-19.10
        module load netcdf-python
esac

./icon-dev.checksuite
STATUS=$?

check_final_status $STATUS "$EXPERIMENT"


#--------------------------------------------------------------------------------
exit
