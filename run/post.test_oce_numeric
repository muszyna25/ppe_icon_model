EXP="test_oce_numeric"
varNames="ELEV T S"
maskName="wet_c"
oType="eps"
# ================================================================================
# technical stuff
basePath=${ICON_BASE_PATH}
dataPath="${baseBath}../experiments/${EXP}/"
scriptPath="${basePath}/scripts/postprocessing/tools"
nclCaller="nclsh"
plotCmd="${scriptPath}/icon_plot.ncl"
# set the CDO path for the dwd to a local installation
case "$(hostname -d)" in
  dwd.de)
    CDO="/e/uhome/extrmuel/local/bin/cdo"
    ;;
  *)
    CDO="cdo"
esac
# ================================================================================
# plotting
## find the last input file
cd ${dataPath}
iFile=$(ls ${EXP}*.nc | tail -n 1)
## get the index of the last timestamp
nTimesteps=$(cdo sinfov ${iFile} | grep 'Time axis' | cut -d ' ' -f 8)
tOutput=$((nTimesteps - 1))
# perform the ploting
mkdir -p plots
for varname in ${varNames}; do 
  oFile=${varname}_${iFile}
  ${nclCaller} ${plotCmd} -altLibDir=${scriptPath} -oType=${oType} -cdo=${CDO} -isIcon \
    -varName=$varname -maskName=${maskName} -noConfig \
    -iFile=${iFile} -oFile=${oFile} -timeStep=${tOutput}
  mv ${oFile}.${oType} plots/.
  oFile=${varname}_transection_${iFile}
  ${nclCaller} ${plotCmd} -altLibDir=${scriptPath} -oType=${oType} -cdo=${CDO} -isIcon \
    -varName=$varname -maskName=${maskName} -noConfig -secLC=-45,-70 -secRC=30,80 -secPoints=100 -resolution=r360x180 -secMode=circle -rStrg=' '\
    -iFile=${iFile} -oFile=${oFile} -timeStep=${tOutput}
  mv ${oFile}.${oType} plots/.
done
