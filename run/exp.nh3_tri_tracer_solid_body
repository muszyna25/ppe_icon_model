#=============================================================================
#
# This section of the run script containes the specifications of the experiment.
# The specifications are passed by namelist to the program.
# For a complete list see Namelist_overview.pdf
#
# EXPNAME and NPROMA must be defined in as environment variables or must 
# they must be substituted with appropriate values.
#
# Marco Giorgetta, MPI-M, 2010-04-21
# Constantin Junk, MPI-M, 2010-10-19
#-----------------------------------------------------------------------------
#
# Basic specifications of the simulation
# --------------------------------------
#
# These variables are set in the header section of the completed run script:
#
# EXPNAME = experiment name
# NPROMA  = array blocking length / inner loop length
#-----------------------------------------------------------------------------
#
#-----------------------------------------------------------------------------
# The following information is included to present some information on the buildbot-html main page
#
# _bb_table_Description_  Solid body rotation transport test
# _bb_table_Model_        non-hydrost. atmosph.
# _bb_table_Grid_         triangle
#-----------------------------------------------------------------------------
# The following values must be set here as shell variables so that they can be used
# also in the executing section of the completed run script
#
#-----------------------------------------------------------------------------
# the namelist filename
atmo_namelist=NAMELIST_${EXPNAME}
#
#-----------------------------------------------------------------------------
# global timing
start_date="2008-09-01T00:00:00Z"
end_date="2008-09-13T00:00:00Z"
ndays_restart=12
dt_restart=`expr ${ndays_restart} \* 86400`
#
#-----------------------------------------------------------------------------
# model timing
dtime=900
ndays=12
restart_interval="P${ndays}D"
nsteps=`expr ${ndays} \* 86400 / ${dtime}`
dt_diag=`expr 24 \* 3600 `   # int output each 24 hours
dt_file=`expr 30 \* 86400 `   # 30 days per file
dt_data=`expr 288 \* 3600 `  # output each 288 hours
dt_checkpoint=`expr 5 \* 86400 `  # write restart file every 5 days 
#
#-----------------------------------------------------------------------------
# model parameters
atmo_model_equations=3 # equation system
#                     1=hydrost. atm. (T dynamics)
#                     2=hydrost. atm. (theta dynamics)
#                     3=non-hydrost. atm.,
#                    -1=shallow water model
#                    -2=hydrost. ocean
nlev=3              # nlev = number of full levels
iforcing=0        # no forcing
#
#-----------------------------------------------------------------------------
# the grid files
grids_folder="${icon_data_poolFolder}/grids/buildbot"
atmo_dyn_grids='iconR2B04-grid.nc'
#
#-----------------------------------------------------------------------------


#-----------------------------------------------------------------------------
#
# write ICON namelist parameters
# ------------------------
# For a complete list see Namelist_overview and Namelist_overview.pdf
#
cat > ${atmo_namelist} << EOF
!
&parallel_nml
 nproma         = ${nproma}
 p_test_run     = .false.
 l_test_openmp  = .false.
 l_log_checks   = .false.
/
&grid_nml
 ! cell_type is not used = 3            ! triangular cells
 dynamics_grid_filename = "${atmo_dyn_grids}",
/
&run_nml
 num_lev     = ${nlev},      ! number of full levels of vertical grid
 nsteps      = ${nsteps}    ! number of steps length of run
 dtime       = ${dtime}     ! [s] timestep in seconds
 ltestcase   = .TRUE.       ! run testcase                 --> testcase_ctl
 ldynamics   = .FALSE.          ! dynamics
 ltransport  = .TRUE.           ! transport
 iforcing    = ${iforcing}  !
 ntracer     = 2                ! number of tracers - default 0
 msg_level   = 10           ! detailed report during integration
 profiling_output = 3
/
&dynamics_nml
 iequations  = ${atmo_model_equations}       ! 1: hydrost. atmosphere
 lcoriolis   = .FALSE.          ! no coriolis force
 idiv_method      = 1           !
 divavg_cntrwgt   = 0.5
/
&nh_testcase_nml
 nh_test_name   = 'PA'      ! test case identifier PA=pure advection test case
 tracer_inidist_list = 4    ! tracer initial distribution
/
&nonhydrostatic_nml
 itime_scheme     = 1           ! 1=pure advection (no dynamics)
 iadv_rhotheta = 2
 igradp_method = 2  !new default
/
&transport_nml
  tracer_names = '4'            ! list of tracer names
  ihadv_tracer = 3              ! default: miura
  ivadv_tracer = 3              ! default: ppm
  lvadv_tracer = .FALSE.        ! default: .TRUE.
  itype_vlimit = 0              ! default: 1
  itype_hlimit = 0
  lclip_tracer = .FALSE.        ! default: .FALSE.
/
&diffusion_nml
 hdiff_order      = -1          ! -1=no diffusion
 hdiff_efdt_ratio = 0.2         ! ration of e-folding time step
/
&interpol_nml
 llsq_high_consv  = .TRUE.      ! conservative
 lsq_high_ord     = 3           ! 3
/
&io_nml
 dt_checkpoint    = ${dt_checkpoint} ! [s] trigger new restart file
/
&output_nml
 filetype         = 4
 dom              = -1
 output_time_unit = 1
 output_bounds    = 0., 1036800., ${dt_data}   !start, end, increment
 steps_per_file   = 40
 include_last     = .TRUE.
 remap            = 0   ! triangular grid
 output_filename  = '${EXPNAME}'             ! file name base
 output_grid      = .TRUE.
 ml_varlist       = 'u','v','Q4'
/
EOF
#-----------------------------------------------------------------------------
#-----------------------------------------------------------------------------
# add standard atmo_non-hydrostatic_files
. ${thisdir}/add_required_atmo_non-hydrostatic_files
#-----------------------------------------------------------------------------
