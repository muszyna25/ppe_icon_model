#=============================================================================
#
# This section sets up the environment for the proper postprocessing script.
# Parameters are passed by the "set_env" file to be executed by the pp script.
#
#-----------------------------------------------------------------------------

# Set parameters for postprocessing
#
Model="ICOHAM"
EXP="test_hat_jww-moist_cld-cnv-vdf"
config_string="JWw-Moist R2B04"
cell_type=3
horizontal_resolution="R2B04"
vertical_resolution="L31"
physics=2
DOMAIN=""
output_frequency=4
data_file_split=1
post_start=2
post_end=2
plot_file_format="eps"
multi_panel=0
cn_plot_option=1
interp_option=1
rm_tmp_files=1
cdo_silence=1

cd ../scripts/postprocessing/testcases

# Remove old set_env file
#
if [ -f set_env ] 
then 
  rm -f set_env
fi

# Write new set_env file
#
echo "export Model=\"${Model}\""                          >  set_env
echo "EXP=\"${EXP}\""                                     >> set_env
echo "config_string=\"${config_string}\""                 >> set_env
echo "export cell_type=${cell_type}"                      >> set_env
echo "horizontal_resolution=\"${horizontal_resolution}\"" >> set_env
echo "vertical_resolution=\"${vertical_resolution}\""     >> set_env
echo "physics=${physics}"                                 >> set_env
echo "DOMAIN=\"${DOMAIN}\""                               >> set_env
echo "export output_frequency=${output_frequency}"        >> set_env
echo "data_file_split=${data_file_split}"                 >> set_env
echo "export post_start=${post_start}"                    >> set_env
echo "export post_end=${post_end}"                        >> set_env
echo "export plot_file_format=\"${plot_file_format}\""    >> set_env
echo "export multi_panel=${multi_panel}"                  >> set_env
echo "cn_plot_option=${cn_plot_option}"                   >> set_env
echo "interp_option=${interp_option}"                     >> set_env
echo "rm_tmp_files=${rm_tmp_files}"                       >> set_env
echo "cdo_silence=${cdo_silence}"                         >> set_env

# Load NCL resources
#
export NCARG_USRRESFILE=${WORKING_PATH}/scripts/postprocessing/.hluresfile

# Start postprocessing script
echo "-- ---------------------------------------------------------"
echo "-- JWw-Moist_postpro_driver.bash starts at $(date) --"
echo "-- ---------------------------------------------------------"
#
./JWw-Moist_postpro_driver.bash
STATUS=$?
echo "-- ---------------------------------------------------------"
echo "-- JWw-Moist_postpro_driver.bash ends at $(date) --"
echo "-- ---------------------------------------------------------"

rm -f set_env

check_error $STATUS "Creating of Plots"

exit $STATUS
