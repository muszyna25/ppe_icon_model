VERSION_ = 

# Atmosphere setup

ATMO_GRID_ID = 0030
ATMO_GRID_TYPE = R02B03
ATMO_LEVELS = 47

# standard atmosphere timestep: 15 min, 8 substeps (r2b4 values)
# atmospheric timesteps > 15 min are possible with a higher value in hdiff_smag_fac, see diffusion nml
# tested: atmTimeStep="PT20M" / atm_substeps=10 with hdiff_smag_fac=0.15
ATMO_TIME_STEP = PT15M  # 96 time steps per day
ATMO_RADIATION_TIME_STEP = PT2H  # 12 time steps per day
ATMO_DYNAMICS_SUBSTEPS = 8  # ca. 2 min
ATMO_BLOCK_SIZE = 24

# Land setup

LAND_REFERENCE_YEAR = 1992

# Ocean setup

OCEAN_GRID_ID = 0036
OCEAN_GRID_TYPE = R02B04
# 40 unevenly spaced levels used by MPIOM/GR30
OCEAN_LAYER_DEPTHS = "12.0, 10.0, 10.0, 10.0, 10.0, 10.0, 13.0, 15.0, 20.0, 25.0, 30.0, 35.0, 40.0, 45.0, 50.0, 55.0, 60.0, 70.0, 80.0, 90.0, 100.0, 110.0, 120.0, 130.0, 140.0, 150.0, 170.0, 180.0, 190.0, 200.0, 220.0, 250.0, 270.0, 300.0, 350.0, 400.0, 450.0, 500.0, 500.0, 600.0"

OCEAN_TIME_STEP = PT60M  # 24 time steps per day
OCEAN_BLOCK_SIZE = 48

OCEAN_PARENT_DIR = /work/mh0727/m300732/input/${OCEAN_GRID_ID}/ocean/restart
OCEAN_PARENT_EXP_ID = ler0651
OCEAN_PARENT_DATE = 13500101T000000Z

# Ocean biogeochemistry setup

OBGC_EUPHOTIC_LEVELS = 19  # ~500m: 19 for L40, 16 for L20, 26 for L64

# Coupling setup

COUPLER_TIME_STEP = PT60M  # 2 time steps per radiation time step

# Time control

INITIAL_DATE = 1000-01-01
FINAL_DATE = 1010-01-01
INTERVAL = P1Y
OUTPUT_INTERVAL = P1M
SLOW_OUTPUT_INTERVAL = P1Y
WITH_OBGC = true

[namelists]
  
  [[NAMELIST_atm]]
    
    [[[nonhydrostatic_nml]]]
      exner_expol = 0.6
      damp_height = 25000.
      rayleigh_coeff = 0.5000
    [[[diffusion_nml]]]
      hdiff_smag_fac = 0.05  # default: 0.015, higher values increase diffusion
    [[[transport_nml]]]
      tracer_names = hus, clw, cli, o3, co2
      ivadv_tracer = 3, 3, 3, 3, 3
      itype_hlimit = 4, 4, 4, 3, 3
      itype_vlimit = 3, 3, 3, 1, 1
      ihadv_tracer = 52, 2, 2, 52, 52
    [[[echam_gwd_nml]]]
      echam_gwd_config(1)%emiss_lev = 20
    [[[echam_sso_nml]]]
      echam_sso_config(1)%gkdrag = 0.005  # default: 0.05
      echam_sso_config(1)%gkwake = 0.005  # default: 0.05
      echam_sso_config(1)%gklift = 0.7
    [[[echam_vdf_nml]]]
      echam_vdf_config(1)%pr0 = 0.8  # default: 1.0; lower values help to avoid negative humidities
      echam_vdf_config(1)%c_n = 1.0
      echam_vdf_config(1)%fsl = 0.5
    [[[echam_cnv_nml]]]
      echam_cnv_config(1)%entrpen = 0.00025
    [[[echam_cld_nml]]]
      echam_cld_config(1)%csecfrl = 0.7e-5
    [[[echam_cov_nml]]]
      echam_cov_config(1)%crt = 0.93  # Critical relative humidity at toa, (0.8)
    [[[sea_ice_nml]]]
      hci_layer = 0.2
      albs = 0.865  # Albedo of snow (not melting) (0.85)
      albsm = 0.7  # Albedo of snow (melting) (0.70)
      albi = 0.75  # Albedo of ice (not melting) (0.80)
      albim = 0.7  # Albedo of ice (melting) (0.75)
    [[[dbg_index_nml]]]
      idbg_mxmn = 1

    [[[output_nml atm_3d]]]
      ml_varlist = zg, ps, pfull, rho, ta, ua, va, wap, hus, clw, cli, hur, cl, qco2_phy, mco2vi_phy, tend_mco2vi_phy
    [[[output_nml atm_2d]]]
      ml_varlist = orog, ps, psl, cosmu0, rsdt, rsut, rsutcs, rlut, rlutcs, rsds, rsdscs, rlds, rldscs, rsus, rsuscs, rlus, ts, sic, sit, albedo, clt, prlr, prls, prcr, prcs, pr, prw, cllvi, clivi, hfls, hfss, evspsbl, tauu, tauv, tauu_sso, tauv_sso, diss_sso, sfcwind, uas, vas, tas, dew2, ptp, co2_flux_wtr, co2_flux_ice, co2_flux_lnd, fco2nat
    # Additional land variables for basic output set
    [[[output_nml lnd_basic]]]
      ml_varlist = group:jsb_all_basic, hd_water_error_box, hydro_discharge_ocean_box, hydro_discharge_box
    [[[echam_rad_nml]]]
      echam_rad_config(1)%irad_co2 = 1
    [[[ccycle_nml]]]
      ccycle_config(1)%iccycle = 1  # 0:none, 1:interactive, 2:prescribed
  
  [[NAMELIST_oce]]
    
    [[[dbg_index_nml]]]
      idbg_mxmn = 1  # initialize MIN/MAX debug output
      idbg_val = 0  # initialize one cell debug output
      idbg_slev = 1  # initialize start level for debug output
      idbg_elev = 2  # initialize end level for debug output
      dbg_lat_in = 30.0  # latitude location of one cell debug output
      dbg_lon_in = -30.0  # longitude location of one cell debug output
      str_mod_tst = oceanCouplng  # define modules to print out in debug mode
    [[[ocean_dynamics_nml]]]
      solver_tolerance = 1.0E-13  # this may further be reduced
    [[[ocean_horizontal_diffusion_nml]]]
      harmonicviscosity_reference = 5.0E+4
    [[[ocean_vertical_diffusion_nml]]]
      temperature_verticaldiffusion_background = 5.0E-5
      salinity_verticaldiffusion_background = 5.0E-5
      tracer_topwindmixing = 1.0E-5
      velocity_topwindmixing = 1.0E-5
    [[[ocean_gentmcwilliamsredi_nml]]]
      k_tracer_gm_kappa_parameter = 800.0
      k_tracer_isoneutral_parameter = 800.0
      s_max = 3.0e-5
    [[[sea_ice_nml]]]
      i_ice_therm = 1  # 1=zero-layer (default), 2=Winton, 0/2: not allowed
      i_ice_dyn = 1  # 1/0=switch on/off AWI ice dynamics
      # i_qio_type = 3 # 3 (default): energy of whole grid-area used for melting (MPIOM-type)
      # use_constant_tfreez = true # default: TRUE
      # use_no_flux_gradients = false # default: TRUE
      leadclose_1 = 0.5  # default: 0.5 - value of MPIOM: 0.25
      leadclose_2n = 0.0  # default: 0.0 - value of MPIOM: 2/3
    [[[hamocc_nml]]]
      l_cyadyn = true  # dynamic cyanobacteria
      l_cpl_co2 = true  # CO2 coupled to land carbon cycle
      l_bgc_check = false  # mass check at every time step
      deltacalc = 386.6  # CaCO3 weathering rate [kmol/s] 
      deltaorg = 16.8  # OC weathering rate [kmol/s]
      deltasil = 1166.2  # Si(OH)4 weathering rate [kmol/s]
      atm_co2 = 284.3  # atmospheric CO2 (default 278)
      atm_n2 = 802000.  # atmospheric N2 (default 802000)
      atm_o2 = 196800.  # atmospheric O2 (default 196800)
      sinkspeed_opal = 25.  # opal sinking speed [m/d] (default 30)
      sinkspeed_calc = 30.  # calc sinking speed [m/d] (default 30)
      i_settling = 1  # 0 constant POC sinking speed, 1 Martin curve, 2 AGG module (not yet implemented)
      sinkspeed_poc = 5.  # detritus sinking speed [m/d] for i_settling=0 (default 5)
      sinkspeed_martin_ez = 3.5  # detritue sinking speed within (0, mc_depth) [m/d] for i_settling=1 (default 3.5)
      mc_depth = 100.  # depth where linear increase of sinking speed starts for i_settling=1 (default 100.)
      mc_fac = 2.0  # slope of sinking speed increase relative to remin rate (default 2.0)
      l_implsed = false  # implicit sediment formulation
      cycdec = 0.07
      cya_growth_max = 0.3
      grazra = 0.7
      l_init_bgc = true
    
    [[[output_nml oce_def]]]
      ml_varlist = group:oce_default, group:oce_essentials
  
  [[coupling.xml]]
    include_co2 = true
  [[NAMELIST_lnd]]
    with_carbon = true

[files]
  
  [[coupler]]
    .base_dir = $MODEL_DIR/externals/yac/input
    .method = cp -fv
    coupling.xsd = .
  
  [[atmosphere]]
    .base_dir = $${icon_data_poolFolder}
    [[[model]]]
      .base_dir = $MODEL_DIR
      [[[[data]]]]
        .sub_dir = data
        lsdata.nc = .
        ECHAM6_CldOptProps.nc = .
      [[[[run]]]]
        .method = cp -fv
        .sub_dir = run
        dict.txt = dict.iconam.mpim
    [[[mapped]]]
      .sub_dir = $ATMO_GRID_ID
      [[[[initial]]]]
        .sub_dir = initial_condition/r0002
        ifs2icon.nc = ifs2icon_1979010100_${ATMO_GRID_TYPE}_G.nc
      [[[[ozone]]]]
        .sub_dir = ozone/r0002
        bc_ozone.nc = bc_ozone_picontrol.nc
      [[[[ocean_surface]]]]
        .year = "add_years($INITIAL_DATE, -1)"
        .sub_dir = sst_and_seaice/r0002
        .method = "cdo -settaxis,${.year},,1month -selyear,1978/1980"
        bc_sic.nc = bc_sic_1979_2016.nc
        bc_sst.nc = bc_sst_1979_2016.nc
    [[[solar_irradiance]]]
      .sub_dir = independent/solar_radiation/3.2
      bc_solar_irradiance_sw_b14.nc = swflux_14band_cmip6_1850-2299-v3.2.nc
  
  [[land]]
    [[[mapped]]]
    .sub_dir = ${ATMO_GRID_ID}-${OCEAN_GRID_ID}/land/r0001
    [[[hydro]]]
      # FIXME move hdpara file to pool directory and adapt path
      .base_dir = /work/mh0727/m300732/input/hd
      bc_land_hd.nc = hdpara_${atmo_grid}_${ATMO_GRID_ID}_${OCEAN_GRID_ID}_no_sinks_half_frac_lnd_adjusted.nc
  
  [[ocean]]
    .base_dir = /pool/data/ICON/grids/public/mpim
    [[[grids]]]
      .sub_dir = $OCEAN_GRID_ID

[jobs]
  mon_tags = atm_mon, oce_mon, hamocc_monitor
  [[run]]
    # 1 ocean node is sufficient for low resolution, 9 nodes for coupled
    # faster: 2 nodes for ocean, 16 nodes in total
    # running with Hamocc: 6 nodes for ocean, 20 in total
    # faster: 8 nodes for ocean, 22 in total
    nodes = 22
    ocean_nodes = 8
    time_limit = 02:00:00
  [[post]]
    tasks = 8
    time_limit = 00:05:00
  [[mon]]
    tasks = 4
    time_limit = 00:05:00
