#! /bin/bash
#________________________________________________________________________________________________
#
# Luis Kornblueh, MPI-M, 2013-06-24
#
#________________________________________________________________________________________________
#
#
set -eu
#
#________________________________________________________________________________________________
# cmake $(pwd) is doing in-source build - only to get Find<*>.cmake running.
#
# GCC: gcc, gfortran
#
# cleanup old stuff
#
find . -name CMakeCache.txt -print -exec rm -f {} \; 2> /dev/null || ret=$?
#
find . -name CMakeFiles -print -exec rm -rf {} \; 2> /dev/null || ret=$?
#________________________________________________________________________________________________
# select netcdf version
#use_netcdf=3.6
#use_netcdf=4.1
use_netcdf=4.2
#
#________________________________________________________________________________________________
# select machine specifics
#
case $(hostname) in
    thunder*)
	# enable loading of modules on thunder
	set +u
	. /sw/share/Modules/init/bash
	set -u
	# selected necdf version's path on thunder
	case $use_netcdf in
	    3.6)
		export NETCDFROOT=/scratch/mpi/mh0033/m214089/sandbox/netcdf-3.6.3
		;;
	    4.1)
		export NETCDFROOT=/sw/squeeze-x64/netcdf-4.1.3-static-gcc47
		export HDF5ROOT=/sw/squeeze-x64/hdf5-1.8.8-static
		;;
	    4.2)
		export NETCDFROOT=/sw/squeeze-x64/netcdf-4.2.1.1-static 
		export NETCDFFROOT=/sw/squeeze-x64/netcdf_fortran-4.2-static-gcc47 
		export HDF5ROOT=/sw/squeeze-x64/hdf5-1.8.8-static
		;;
	    *)
		echo Selected netCDF version $use_netcdf not available ... 
		exit 1
		;;
	esac
        # make MPI wrapper calls available
	module load mvapich2/1.9b-static-gcc47 
        # call cmake now        
	CC=gcc CFLAGS=-DpgiFortran \
	FC=gfortran \
	cmake $(pwd)
        ;;
    wanglung*)
	CC=gcc CFLAGS=-DpgiFortran \
	FC=gfortran \
	NETCDFROOT=/opt/local \
	NETCDFFROOT=/opt/local \
	cmake $(pwd)
	;;
    thingol*)
	CC=gcc CFLAGS=-DpgiFortran \
	FC=gfortran \
	NETCDFROOT=/usr \
	NETCDFFROOT=/usr \
	cmake $(pwd)
	;;
esac
#________________________________________________________________________________________________
#
