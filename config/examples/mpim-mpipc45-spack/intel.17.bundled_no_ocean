#!/bin/bash

set -eu

SCT_ROOT='/scratch/local1/icon-bootstrap/opt/intel-17.0.2/libsct-develop-thlpfyg'
SCT_LIBS='-lsct'

GRIBAPI_ROOT='/scratch/local1/icon-bootstrap/opt/intel-17.0.2/grib-api-1.24.0-72kogpw'
GRIBAPI_LIBS='-lgrib_api'

NETCDF_ROOT='/scratch/local1/icon-bootstrap/opt/intel-17.0.2/netcdf-4.6.1-ngd34ld'
NETCDF_LIBS='-lnetcdf'

NETCDFF_ROOT='/scratch/local1/icon-bootstrap/opt/intel-17.0.2/netcdf-fortran-4.4.4-msryzc7'
NETCDFF_LIBS='-lnetcdff'

BLAS_ROOT='/scratch/local1/icon-bootstrap/opt/intel-17.0.2/netlib-lapack-3.8.0-uszzl6m'
BLAS_LIBS='-lblas'

LAPACK_ROOT='/scratch/local1/icon-bootstrap/opt/intel-17.0.2/netlib-lapack-3.8.0-uszzl6m'
LAPACK_LIBS='-llapack'

XML_ROOT='/scratch/local1/icon-bootstrap/opt/intel-17.0.2/libxml2-2.9.8-uuiuh3w'
XML_LIBS='-lxml2'

######################

BUILD_ENV='export ICCCFG="/sw/stretch-x64/intel/intel-17.0.2/bin/rpath.cfg"; export IFORTCFG="$ICCCFG";'

FC='/scratch/local1/icon-bootstrap/opt/intel-17.0.2/mpich-3.2.1-ohqiwpy/bin/mpif90'
CC='/scratch/local1/icon-bootstrap/opt/intel-17.0.2/mpich-3.2.1-ohqiwpy/bin/mpicc'

FCFLAGS="-I${SCT_ROOT}/include -I${NETCDFF_ROOT}/include"
CFLAGS='-gcc-name=/usr/bin/gcc'
CPPFLAGS="-I${GRIBAPI_ROOT}/include -I${NETCDF_ROOT}/include -I${XML_ROOT}/include/libxml2"

LDFLAGS="-L${SCT_ROOT}/lib -L${GRIBAPI_ROOT}/lib -L${NETCDF_ROOT}/lib -L${NETCDFF_ROOT}/lib -L${BLAS_ROOT}/lib -L${LAPACK_ROOT}/lib -L${XML_ROOT}/lib"
LIBS="${XML_LIBS} ${LAPACK_LIBS} ${BLAS_LIBS} ${NETCDFF_LIBS} ${NETCDF_LIBS} ${GRIBAPI_LIBS} ${SCT_LIBS}"

$(cd "$(dirname "$0")"; pwd)/../../../configure BUILD_ENV="$BUILD_ENV" FC="$FC" FCFLAGS="$FCFLAGS" CC="$CC" CFLAGS="$CFLAGS" CPPFLAGS="$CPPFLAGS" LDFLAGS="$LDFLAGS" LIBS="$LIBS" --enable-sct --enable-grib2 --enable-yaxt --disable-ocean "$@"

