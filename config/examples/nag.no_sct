#!/bin/bash

set -eu

NETCDFF_ROOT='/scratch/local1/icon-bootstrap/opt/nag-6.2/netcdf-fortran-4.4.4-63bnpcj'
NETCDFF_LIBS='-lnetcdff'

MTIME_ROOT='/scratch/local1/icon-bootstrap/opt/nag-6.2/libmtime-1.0.8-xabszez'
MTIME_LIBS='-lmtime'

SELF_ROOT='/scratch/local1/icon-bootstrap/opt/nag-6.2/libself-0.2-iefxuap'
SELF_LIBS='-lself'

LAPACK_ROOT='/scratch/local1/icon-bootstrap/opt/nag-6.2/netlib-lapack-3.8.0-footyva'
LAPACK_LIBS='-llapack'

BLAS_ROOT='/scratch/local1/icon-bootstrap/opt/nag-6.2/netlib-lapack-3.8.0-footyva'
BLAS_LIBS='-lblas'

CDI_ROOT='/scratch/local1/icon-bootstrap/opt/nag-6.2/libcdi-1.8.2-j6ugmwh'
CDI_LIBS='-lcdi_f2003 -lcdi'

YAC_ROOT='/scratch/local1/icon-bootstrap/opt/nag-6.2/yac-1.3.2-mma6qpo'
YAC_LIBS='-lyac -L/scratch/local1/icon-bootstrap/opt/nag-6.2/libxml2-2.9.8-chuop5e/lib -Wl,-Wl,,-rpath -Wl,-Wl,,/scratch/local1/icon-bootstrap/opt/nag-6.2/libxml2-2.9.8-chuop5e/lib -lxml2 -L/scratch/local1/icon-bootstrap/opt/nag-6.2/netcdf-4.6.1-yalf6ng/lib -Wl,-Wl,,-rpath -Wl,-Wl,,/scratch/local1/icon-bootstrap/opt/nag-6.2/netcdf-4.6.1-yalf6ng/lib -lnetcdf'

FC='/scratch/local1/icon-bootstrap/opt/nag-6.2/mpich-3.2.1-w7ksmw2/bin/mpif90'
CC='/usr/bin/gcc'

######################

FCFLAGS="-mismatch -I${CDI_ROOT}/include -I${NETCDFF_ROOT}/include -I${MTIME_ROOT}/include -I${YAC_ROOT}/include -I${SELF_ROOT}/include"

LDFLAGS="-L${CDI_ROOT}/lib -L${NETCDFF_ROOT}/lib -L${MTIME_ROOT}/lib -L${BLAS_ROOT}/lib -L${LAPACK_ROOT}/lib -L${YAC_ROOT}/lib -L${SELF_ROOT}/lib"

# Append RPATHs:
LDFLAGS=$(echo ${LDFLAGS} | sed 's%\(-L\s*\(\S\+\)\)%\1 -Wl,-Wl,,-rpath -Wl,-Wl,,\2%g')

LIBS="${SELF_LIBS} ${YAC_LIBS} ${MTIME_LIBS} ${LAPACK_LIBS} ${BLAS_LIBS} ${CDI_LIBS} ${NETCDFF_LIBS}"

$(cd "$(dirname "$0")"; pwd)/../../configure FC="$FC" FCFLAGS="$FCFLAGS" CC="$CC" LDFLAGS="$LDFLAGS" LIBS="$LIBS" --disable-openmp --with-external-mtime --with-external-self --with-external-cdi --with-external-yac --disable-sct "$@"
